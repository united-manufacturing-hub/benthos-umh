input:
  sensorconnect:
    device_address: "${DEVICE_ADDRESS}"
    iodd_api: "${IODD_API}"

pipeline:
  processors:
    - bloblang: |
          # these variables are autogenerated from your instance location
          let enterprise = "enterprise-of-kings"
          let site = "jeremy-vm"
          let area = "AL1350-2"
          let schema = "_historian"
          let invalid_payload = this.catch(true)
          if $invalid_payload == true { # this means it is not a json and instead a digital input
            let payload = {
              "timestamp_ms": (timestamp_unix_nano() / 1000000).floor(),
              "digital-input": content().string()
            }
          } else {
            let payload = this
            # add timestamp to the json
            payload."timestamp_ms" = (timestamp_unix_nano() / 1000000).floor()
            # put all metadata into the metadata object
            payload."metadata" = metadata()
          }
          # the rest from here here on will be autogenerated, see also documentation
          let tagname = meta("sensorconnect_port_number")

          root = {
            "payload": $payload,
            "metadata": metadata(),
            "tagname": $tagname,
          }
output:
  stdout: {}
